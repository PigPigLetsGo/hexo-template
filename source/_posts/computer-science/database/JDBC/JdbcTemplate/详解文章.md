---
title: JdbcTemplate详解
categories:
    - [计算机学科,database,JDBC]
tags:
    - 计算机学科
    - database
    - JDBC
    - JdbcTemplate
    - 基础
---

## JdbcTemplate详解

### 一,JdbcTemplate(概念和准备)

1.  什么是JdbcTemplate(Template译为模板)
    -  Sprint框架对JDBC进行封装,使用JdbcTemplate方便实现对数据库操作
2.  准备工作
    1.  引入相关jar包,我们还需要导入连接数据库的相关jar包,比如:`druid,mysql-connector-java`

![image-20221217143453718](https://gitee.com/Doukaixin/note_image/raw/master/https://gitee.com/doukaixin/note_image/image-20221217143453718.png)

我们需要的是`spring-jdbc-5.0.0.RELEASE.jar`,除了要导入这个jar包外,还需要导入一个`spring-tx-5.0.0.RELEASE.jar`(它 是 和事务相关的)

> spring JDBC

Spring框架对JDBC的简单封装,提供了一个JDBCTemplate对象简化JDBC的开发

- 步骤:
    1. 导入jar包
    2. 创建JdbcTemplate对象,依赖于数据源DataSource
        - JdbcTemplate template = new JdcbTemplate(ds);

调用JdbcTemplate的方法来完成CRUD的操作

1. update():执行DML语句,增,删,改语句

2. queryForMap():执行DQL查询结果将结果集封装为map集合

3. queryForList():执行DQL查询结果将结果集封装为list集合
    - 将每一条记录封装为一个Map集合,再将Map集合装载到List集合中

4. query():执行DQL查询结果,将结果封装为JavaBean对象

5. queryForObject():执行DQL查询结果,将结果封装为对象
    - 一般用于聚合函数的查询

- 案例:

- 增

```java
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
   String sql = "insert into user values(?,?)";
   int update = jdbcTemplate.update(sql, null, "王五");
   if(update > 0){
       System.out.println("执行成功!");
   }else{
       System.out.println("执行失败!");
}
```

- 删

```java
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
    String sql = "delete from user where id=?";
    int update = jdbcTemplate.update(sql, 1);
    if(update > 0){
        System.out.println("执行成功!");
    }else{
        System.out.println("执行失败!");
}
```

- 改

```java
public static void main(String[]args){
    JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
    String sql = "update user set name='马牛逼' where id=?";
    int update = jdbcTemplate.update(sql, 2);
    if(update > 0){
        System.out.println("执行成功!");
    }else{
        System.out.println("执行失败!");
    }
}
```

> DQL

- queryForMap 查询单行

```java
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
String sql = "select * from user where id = ?";
Map<String, Object> map = jdbcTemplate.queryForMap(sql,  2);
System.out.println(map);
```

- queryForList 查询多行

```java
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
String sql = "select * from user where id = ? or id = ?";
List<Map<String, Object>> maps = jdbcTemplate.queryForList(sql,  2,3);
System.out.println(maps);
```

- queryForObject 查询单行,返回对象 一般用于聚合函数的查询

```java
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
String sql = "select * from user where id = ?";
User user = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper<User>(User.class), 2);
System.out.println(user);
//===========================================================
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
String sql = "select count(id) from user";
int i = jdbcTemplate.queryForObject(sql,int.class);
System.out.println(i);
```

- query 查询多行,返回JavaBean对象并封装到List集合中

```java
JdbcTemplate jdbcTemplate = new JdbcTemplate(JDBCUtils.getDataSource());
String sql = "select * from user";
List<User> list = jdbcTemplate.query(sql,new BeanPropertyRowMapper<User>(User.class));
System.out.println(list);
```
