---
title: æ”¯ä»˜å®æ”¯ä»˜-æ²™ç®±ç‰ˆé…ç½®
categories:
   - [è®¡ç®—æœºå­¦ç§‘,java,ç¬¬ä¸‰æ–¹åº“]
tags:
   - è®¡ç®—æœºå­¦ç§‘
   - java
   - ç¬¬ä¸‰æ–¹åº“
   - é¡¹ç›®
---

## ä¸€ã€æ”¯ä»˜å®-æ²™ç®±ç‰ˆé…ç½®

è¿›å…¥æ”¯ä»˜å®çš„å¼€å‘å¹³å°é¡µé¢ï¼šhttps://auth.alipay.com/login/ant_sso_index.htm?goto=https%3A%2F%2Fopen.alipay.com%2Fdevelop%2Fsandbox%2Faccount

éœ€è¦æ‰«ç ç„¶åè¿›å…¥

![image-20240303161638927](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161638927.png)

## äºŒã€ä¸‹è½½æ‰€éœ€çš„å·¥å…·-(å¯†é’¥å·¥å…·)

è®¿é—®ä¸‹è½½åœ°å€ï¼šhttps://opendocs.alipay.com/open/02kipk?pathHash=3dce99f3

![image-20240303161656044](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161656044.png)

ä¸‹è½½å®Œåæ‰“å¼€è¿™ä¸ªå·¥å…·ï¼Œç„¶åç”Ÿæˆå¯†é’¥

![image-20240303161710370](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161710370.png)

## ä¸‰ã€æ¥å£åŠ ç­¾æ–¹å¼é…ç½®å¯†é’¥

ğŸ”‘

>  å›åˆ°å¼€å‘å¹³å°ï¼Œæ‰“å¼€æ§åˆ¶å°å†æ¬¡è¿›å…¥æ²™ç®±åº”ç”¨ï¼Œé…ç½®å…¬é’¥æ¨¡å¼

1ã€ç‚¹å‡» è‡ªå®šä¹‰å¯†é’¥

2ã€ç‚¹å‡»è®¾ç½®å¹¶æŸ¥çœ‹

![image-20240303161730054](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161730054.png)

æ‰“å¼€åï¼ŒæŠŠåˆšåˆšåœ¨ä¸‹è½½çš„å¯†é’¥å·¥å…·ä¸­==ç”Ÿæˆçš„åº”ç”¨å…¬é’¥==å¤åˆ¶è¿›å»

![image-20240303161753291](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161753291.png)

å¤åˆ¶è¿›å»ä¹‹åç‚¹ä¿å­˜ï¼Œå°±å¯ä»¥äº†

![image-20240303161808335](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161808335.png)

## å››ã€é…ç½®yml

è¿™ä¸ªé…ç½®å½“æ—¶è¢«é…ç½®åœ¨äº†nacosä¸­ï¼Œç„¶åä½¿ç”¨@Valueè¿›è¡Œè¯»å–è¿™äº›å€¼

```yaml
pay:
 alipay:
  # APPID
  APP_ID: 9021000131682336
  # æ”¯ä»˜å®å…¬é’¥
  APP_PRIVATE_KEY: MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCK07qIDJgLq18PlNwU7MokEiHCY/4vylHmpBAIeJuCsJ9KpwBTsIbtpob74a+NaRSTtJYucRpmmpBUemfDth9oLn4IZYGrxq3xpwO30e8wuZUj7zX/ZUIM7hTgk8gmQXA67Nplmsw7AUIXc/vLX8NIsRZgSM+SwJ5YnL/FoSvLwf8x38SPbFu0DSDLo+yCOz8i2imsotdxP0Pg6NsRZyPHVmnQw8nqDWl3odC1hOmjt6WK+xuEoGh/hsFGt1WSo+aNHQSiZ4tDILWEnlGuo4NagJXIVJR5hA0ZA2SOfxFbpvY663N0ep6o/2pO+d06ifgvFWfYxHNaUG99MFs5AWmXAgMBAAECggEATLBXi45Bc7jQQ4A870Y7CCAIDCVGpknCYoFg5f0SEujUpd2JHbIXZzKlwIDUhG520n1gtPj/14wsjK4tofx6bwe30ZWZQzX2otZbBHFxC16JV5duIc5i5VejqseYOiHOCI8MujH//dxdES2d+6PD8eT5cmjmWbAUCOlWOqsk0WJhl3teViGf0SsDKSBP7OzEPaPNvX5xbEwEwmeyxAOdEq8Dd+5UqvKlk1avYt/SBDZo7ZzC/D2P8NigTBAzvG/25RAgaBJUCZoKug1lvC8ukPeVacbPVyEr41teSuRf7/7sACrCYjmo/h4M6NZ2A+OWYD52LIdKpjsAdTLRma/BaQKBgQDIToLjexksjstKGqA6XFw3FT2+veSAG9rV0esD3R4WCtVAQ+SZa2ZxpSFtapXl+r3leDyqSvWZzXatv1/9Y/ZYZJEHLPm2K6ZU6YxumORR3XVQwDyONwri7cG1DmXrtrEswkO7hOWKnLB3YsYzZVxELHoBCLnDICIFbb6oqDAGwwKBgQCxbTPlRrNhswP2hnMGa9fhmp5Ehs8maqUzuZT5FaZr8cAWkkwBJM2H5+lQFVFs7BmOQ2VusZk9vUflRyUcn7Tr0uSN0tz4Yn8I9QPflKBryi0PduYHrKFSeKZDIb/CwCD4l+lmOlMzfQYLVVdnCQyCR4Rz1oQFwdwOzCqaz1FsnQKBgBz2XS6PKgCrVPGOEATgPeUpCRh/VH7BiE7KX3Tbj/IX9uWn63HTeaiM+9xaQPpT2wlG7V6iIAjxEGvm8/Yrcf8t61piQmj4vsAgVNHZAYpkvwXCBf96LfTJ8+w9/LasX8nc/PYsLRRxu4JHoejkiwbAd5OWs2VnTAQE7kBssSUJAoGACLvRZCXYyqRfO5FetCA23joYNFNWexOg0iz+ckxohsO9qt7EswG2xEvcJj8GZRAyKdiTc6F2Y52fnl+kKgaKh1k4Our4SZm/mxdEe4r7YpLvKOW3aQVMY5zgwkk1AUcn2FTR/mA8nDo5Q/GNfdrqLLeMg485rHbgeDIAnuI5pdkCgYAZzz5HAW6qSKwae1xEElm5OdPpZTcvxKIIBoKrXQ30qTKklAt6NV4FmMy9r62zZaEHhLywL9KhX4AGssZ+yaA4tj2NEHuwh2/48TebiRk+ajvYd8EzNBR5a8aH20j3/g/vA8EW+fqBDVWxmsIvGvdIOOhFLEwNWPaVqBq+H5RGGQ==
  # åº”ç”¨ç§é’¥
  ALIPAY_PUBLIC_KEY: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqGTsrjk0otSLuCXUItONzHWQkWUhlV74bAbOpoQrzr82ixtnpsZVj8r6xTao2sPkVe4TlURyezmrX1sTN+4KHQaFK8VUBDLoFs1l/6ESZRLxh1iu3D6G6BikyLQ2pJ36QfZ/HYFZk5ZInP8pCD1zFzacdmA7YMy/+7dzRGkYx7DX/8E+7beQ+Rqr1JDx58ihHH1gCEZG3EQW6/oClABh7IKgSrRIz0pZjxpmg2Y2LkzbiWrZ16tpbmPhbDZ8blcufgME9+YeBdqCwfHgC8YNXvauF7aCPcy7OYbLBAZJwJML8sudIgqQlwpwuHHrbV/S7QI/cGbg5tEvFaQvCwF0SwIDAQAB
```

å¯¹åº”å¦‚ä¸‹ï¼š

APPID

![image-20240303161839100](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161839100.png)

æ”¯ä»˜å®å…¬é’¥

![](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161839100.png)

åº”ç”¨ç§é’¥

![image-20240303161904933](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161904933.png)

å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿å°±æ˜¯ æ”¯ä»˜å®ç½‘å…³åœ°å€ï¼ŒæŸ¥çœ‹å¦‚ä¸‹ï¼š

![image-20240303161929563](https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303161929563.png)

## ç¼–å†™ä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š

éœ€è¦çš„ä¾èµ–ï¼š

æ”¯ä»˜å®

```xml
<!-- æ”¯ä»˜å®SDK -->
<dependency>
    <groupId>com.alipay.sdk</groupId>
    <artifactId>alipay-sdk-java</artifactId>
    <version>4.38.128.ALL</version>
</dependency>

<!-- æ”¯ä»˜å®SDKä¾èµ–çš„æ—¥å¿— -->
<dependency>
    <groupId>commons-logging</groupId>
    <artifactId>commons-logging</artifactId>
    <version>1.2</version>
</dependency>
```

ç”ŸæˆäºŒç»´ç 

```xml
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
</dependency>
<dependency>
    <groupId>com.google.zxing</groupId>
    <artifactId>core</artifactId>
    <version>3.3.3</version>
</dependency>

<dependency>
    <groupId>com.google.zxing</groupId>
    <artifactId>javase</artifactId>
    <version>3.3.3</version>
</dependency>
```

controller ä»£ç 

```java
@Controller
public class PayTestController {
    @Value("${pay.alipay.APP_ID}")
    String APP_ID;
    @Value("${pay.alipay.APP_PRIVATE_KEY}")
    String APP_PRIVATE_KEY;
    @Value("${pay.alipay.ALIPAY_PUBLIC_KEY}")
    String ALIPAY_PUBLIC_KEY;

    @RequestMapping("alipaytest")
    public void doPost(HttpServletRequest httpRequest,
                       HttpServletResponse httpResponse) throws ServletException, IOException, AlipayApiException {
        AlipayClient alipayClient = new DefaultAlipayClient(AlipayConfig.URL, APP_ID, APP_PRIVATE_KEY, AlipayConfig.FORMAT, AlipayConfig.CHARSET, ALIPAY_PUBLIC_KEY,AlipayConfig.SIGNTYPE);
        AlipayTradeWapPayRequest alipayRequest = new AlipayTradeWapPayRequest();//åˆ›å»ºAPIå¯¹åº”çš„request
//        alipayRequest.setReturnUrl("http://domain.com/CallBack/return_url.jsp");
//        alipayRequest.setNotifyUrl("http://tjxt-user-t.itheima.net/xuecheng/orders/paynotify");//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€
        alipayRequest.setBizContent("{" +
                "    \"out_trade_no\":\"20230320010102005\"," +
                "    \"total_amount\":0.1," +
                "    \"subject\":\"Iphone14 16G\"," +
                "    \"product_code\":\"QUICK_WAP_WAY\"" +
                "  }");//å¡«å……ä¸šåŠ¡å‚æ•°
        String form = alipayClient.pageExecute(alipayRequest).getBody(); //è°ƒç”¨SDKç”Ÿæˆè¡¨å•
        httpResponse.setContentType("text/html;charset=" + AlipayConfig.CHARSET);
        httpResponse.getWriter().write(form);//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢
        httpResponse.getWriter().flush();
    }
}
```

config ä»£ç 

```java
public class AlipayConfig {
  // å•†æˆ·appid
//	public static String APPID = "";
  // ç§é’¥ pkcs8æ ¼å¼çš„
//	public static String RSA_PRIVATE_KEY = "";
  // æœåŠ¡å™¨å¼‚æ­¥é€šçŸ¥é¡µé¢è·¯å¾„ éœ€http://æˆ–è€…https://æ ¼å¼çš„å®Œæ•´è·¯å¾„ï¼Œä¸èƒ½åŠ ?id=123è¿™ç±»è‡ªå®šä¹‰å‚æ•°ï¼Œå¿…é¡»å¤–ç½‘å¯ä»¥æ­£å¸¸è®¿é—®
  public static String notify_url = "http://å•†æˆ·ç½‘å…³åœ°å€/alipay.trade.wap.pay-JAVA-UTF-8/notify_url.jsp";
  // é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥é¡µé¢è·¯å¾„ éœ€http://æˆ–è€…https://æ ¼å¼çš„å®Œæ•´è·¯å¾„ï¼Œä¸èƒ½åŠ ?id=123è¿™ç±»è‡ªå®šä¹‰å‚æ•°ï¼Œå¿…é¡»å¤–ç½‘å¯ä»¥æ­£å¸¸è®¿é—® å•†æˆ·å¯ä»¥è‡ªå®šä¹‰åŒæ­¥è·³è½¬åœ°å€
  public static String return_url = "http://å•†æˆ·ç½‘å…³åœ°å€/alipay.trade.wap.pay-JAVA-UTF-8/return_url.jsp";
  // è¯·æ±‚ç½‘å…³åœ°å€
  public static String URL = "https://openapi-sandbox.dl.alipaydev.com/gateway.do";
  // ç¼–ç 
  public static String CHARSET = "UTF-8";
  // è¿”å›æ ¼å¼
  public static String FORMAT = "json";
  // æ”¯ä»˜å®å…¬é’¥
//	public static String ALIPAY_PUBLIC_KEY = "";
  // æ—¥å¿—è®°å½•ç›®å½•
  public static String log_path = "/log";
  // RSA2
  public static String SIGNTYPE = "RSA2";
 }
```

ç”ŸæˆäºŒç»´ç çš„ä»£ç ï¼š

```java
public class QRCodeUtil {
    /**
     * ç”ŸæˆäºŒç»´ç 
     *
     * @param content äºŒç»´ç å¯¹åº”çš„URL
     * @param width   äºŒç»´ç å›¾ç‰‡å®½åº¦
     * @param height  äºŒç»´ç å›¾ç‰‡é«˜åº¦
     * @return
     */
    public String createQRCode(String content, int width, int height) throws IOException {
        String resultImage = "";
        //é™¤äº†å°ºå¯¸ï¼Œä¼ å…¥å†…å®¹ä¸èƒ½ä¸ºç©º
        if (!StringUtils.isEmpty(content)) {
            ServletOutputStream stream = null;
            ByteArrayOutputStream os = new ByteArrayOutputStream();
            //äºŒç»´ç å‚æ•°
            @SuppressWarnings("rawtypes")
            HashMap<EncodeHintType, Comparable> hints = new HashMap<>();
            //æŒ‡å®šå­—ç¬¦ç¼–ç ä¸ºâ€œutf-8â€
            hints.put(EncodeHintType.CHARACTER_SET, "utf-8");
            //L M Q Hå››ä¸ªçº é”™ç­‰çº§ä»ä½åˆ°é«˜ï¼ŒæŒ‡å®šäºŒç»´ç çš„çº é”™ç­‰çº§ä¸ºM
            //çº é”™çº§åˆ«è¶Šé«˜ï¼Œå¯ä»¥ä¿®æ­£çš„é”™è¯¯å°±è¶Šå¤šï¼Œéœ€è¦çš„çº é”™ç çš„æ•°é‡ä¹Ÿå˜å¤šï¼Œç›¸åº”çš„äºŒç»´å—å¯å‚¨å­˜çš„æ•°æ®å°±ä¼šå‡å°‘
            hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.M);
            //è®¾ç½®å›¾ç‰‡çš„è¾¹è·
            hints.put(EncodeHintType.MARGIN, 1);

            try {
                //zxingç”ŸæˆäºŒç»´ç æ ¸å¿ƒç±»
                QRCodeWriter writer = new QRCodeWriter();
                //æŠŠè¾“å…¥æ–‡æœ¬æŒ‰ç…§æŒ‡å®šè§„åˆ™è½¬æˆäºŒç»´å—
                BitMatrix bitMatrix = writer.encode(content, BarcodeFormat.QR_CODE, width, height, hints);
                //ç”ŸæˆäºŒç»´ç å›¾ç‰‡æµ
                BufferedImage bufferedImage = MatrixToImageWriter.toBufferedImage(bitMatrix);
                //è¾“å‡ºæµ
                ImageIO.write(bufferedImage, "png", os);
                /**
                 * åŸç”Ÿè½¬ç å‰é¢æ²¡æœ‰ data:image/png;base64 è¿™äº›å­—æ®µï¼Œè¿”å›ç»™å‰ç«¯æ˜¯æ— æ³•è¢«è§£æï¼Œæ‰€ä»¥åŠ ä¸Šå‰ç¼€
                 */
                resultImage = new String("data:image/png;base64," + EncryptUtil.encodeBase64(os.toByteArray()));
                return resultImage;
            } catch (Exception e) {
                e.printStackTrace();
                throw new RuntimeException("ç”ŸæˆäºŒç»´ç å‡ºé”™");
            } finally {
                if (stream != null) {
                    stream.flush();
                    stream.close();
                }
            }
        }
        return null;
    }

    public static void main(String[] args) throws IOException {
        QRCodeUtil qrCodeUtil = new QRCodeUtil();
        System.out.println(qrCodeUtil.createQRCode("http://192.168.0.103:63030/orders/alipaytest", 200, 200));
    }
}
```

ğŸ‘€

>  å½“è°ƒç”¨ QRCodeUtil  ç±»ä¸­çš„mainå‡½æ•°æ—¶å°±ä¼šæ‰“å°å‡ºä¸€ä¸ªäºŒç»´ç çš„urlä¾›è®¿é—®ï¼Œè®¿é—®åå°±ä¼šè·³è½¬åˆ°æ”¯ä»˜å®çš„æ”¯ä»˜controllerå±‚æ¥å£ä¸­è¿›è¡Œæ“ä½œï¼Œå®ƒä¼šè·å–APPIDï¼Œå…¬é’¥ï¼Œç§é’¥ ã€‚ç„¶åå‘ç”¨æˆ·è¿”å›æ”¯ä»˜çš„ä¿¡æ¯ã€‚

å¦‚æœæŠ¥é”™æç¤º å…¬é’¥æˆ–ç§é’¥ä¸åŒ¹é…ï¼Œä¸€å®šè¦æ³¨æ„è‡ªå·±æ˜¯å¦æŒ‰ç…§æµç¨‹ä¸€æ­¥æ¥çš„ï¼Œæ˜¯å¦ ä¸€å¼€å§‹ä½¿ç”¨äº†ä¸€ä¸ªåº”ç”¨å…¬é’¥å»ç”Ÿæˆäº†ä¸€ä¸ª åŠ ç­¾å†…å®¹æ—¶ï¼Œä½†æ˜¯å´åˆç”Ÿæˆäº†ä¸€æ¬¡åº”ç”¨å…¬é’¥è¿™æ ·ä¼šå¯¼è‡´å¯†é’¥ä¸åŒ¹é…è€Œå‡ºç°é”™è¯¯é—®é¢˜ã€‚